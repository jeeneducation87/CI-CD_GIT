# Домашнее задание к занятию «Базы данных, их типы»

### Задание 1 СУБД

Кейс

Крупная строительная компания, которая также занимается проектированием и девелопментом, решила создать правильную архитектуру для работы с данными. Ниже представлены задачи, которые необходимо решить для каждой предметной области.

Какие типы СУБД, на ваш взгляд, лучше всего подойдут для решения этих задач и почему?

1.1. Бюджетирование проектов с дальнейшим формированием финансовых аналитических отчётов и прогнозирования рисков. СУБД должна гарантировать целостность и чёткую структуру данных.

1.1.* Хеширование стало занимать длительно время, какое API можно использовать для ускорения работы?

1.2. Под каждый девелоперский проект создаётся отдельный лендинг, и все данные по лидам стекаются в CRM к маркетологам и менеджерам по продажам. Какой тип СУБД лучше использовать для лендингов и для CRM? СУБД должны быть гибкими и быстрыми.

1.2.* Можно ли эту задачу закрыть одной СУБД? И если да, то какой именно СУБД и какой реализацией?

1.3. Отдел контроля качества решил создать базу по корпоративным нормам и правилам, обучающему материалу и так далее, сформированную согласно структуре компании. СУБД должна иметь простую и понятную структуру.

1.3.* Можно ли под эту задачу использовать уже существующую СУБД из задач выше и если да, то как лучше это реализовать?

1.4. Департамент логистики нуждается в решении задач по быстрому формированию маршрутов доставки материалов по объектам и распределению курьеров по маршрутам с доставкой документов. СУБД должна уметь быстро работать со связями.

1.4.* Можно ли к этой СУБД подключить отдел закупок или для них лучше сформировать свою СУБД в связке с СУБД логистов?

1.5.* Можно ли все перечисленные выше задачи решить, используя одну СУБД? Если да, то какую именно?

Приведите ответ в свободной форме.


### Решение 1 СУБД

1.1
Бюджетирование проектов, аналитика, прогнозирование рисков
- Так как требования к системе включает в себя гарантии целостности данных, чётко структурированные данные и поддержку сложных аналитических запросов, то рекомендуется использовать реляционные СУБД. Например PostgreSQL, MS SQL Server, Oracle, MySQL.
Реляционные СУБД исторически идеальны для финансовых данных — транзакции, поддержка строгих ограничений (ACID), развитые средства аналитики (OLAP и тп), поддержка внешних ключей, индексов, триггеров и т.д.

1.1.*
- Использовать нативные (встроенные) функции хеширования в СУБД (например, pgcrypto в PostgreSQL, HASHBYTES в MS SQL Server).
- Для ускорения — выносить вычисления в микросервис, написанный на Go или Rust (очень быстрые хеш-функции).

1.2
Лендинги и CRM, сбор и обработка лидов
- Возможные требования к системе - гибкость (частые изменения схемы, разные типы данных) и скорость записи\чтения.
Для лендингов (форма заявок): NoSQL (MongoDB), для CRM: Реляционная СУБД (PostgreSQL).
Лендинги часто генерируют разнородные данные, могут меняться поля — удобно использовать документоориентированную СУБД, например MongoDB.
CRM требует отчетности, связей между сущностями, транзакционности — реляционная СУБД, например PostgreSQL или MS SQL Server предпочтительнее.

1.2.*
- Можно сделать все на одной СУБД без разделения на реляционную и NoSQL. Возможно подойдет PostgreSQL с JSONB. Для лендингов данные можно хранить в JSONB-полях (гибкость, возможность быстрого хранения/чтения), а для CRM — классическая реляционная схема. Однако больших проектов предпочтительнее гибридная схема с разными типами СУБД.

1.3
База правил, норм и обучающих материалов
- Требуется простая и понятная структура и возможность хранения текстов документов, категорий и тп материалов. 
Вероятно удобнее использовать документо-ориентированную СУБД. Хорошим вариантом может быть MongoDB. В данном случае необходимость документы могут быть различны по своим атрибутам и непохожи друг на друга и отпадает необходимость систематизировать данные, чего требуют реляционные СУБД.

1.3.*
- Можно в MongoDB создать новую коллекцию в существующую базу данных (если политика компании это допускает и нет строгого разделения).
Или создать отдельную базу данных для (например, knowledge_base, quality_control и т.д.)

1.4
Логистика: маршруты, курьеры, быстрая работа со связями
- Требования к системе - быстрая работа со связями (графовые задачи поиска оптимальных маршрутов) и масштабируемость.
Графовая СУБД (Neo4j, ArangoDB, Amazon Neptune) — для сложных маршрутов, поиска путей, кластеризации.
Если задачи несложные, то можно использовать и реляционную СУБД PostgreSQL и расширение PostGIS для работы с геоданными.

1.4.*
- Можно подключить к той же СУБД, если закупки тесно связаны с логистикой (например, необходима совместная аналитика, пересечения по маршрутам и складам). Если процессы автономны — лучше все же отдельная схема/база, но с возможностью интеграции.

1.5.*
- Да, можно все перечисленные задачи решить только одной СУБД, однако на практике это не всегда целесообразно. Так как стоит учитывать особенности и нюансы работы организации и автоматизируемые процессы в ней.
Лучшим компромиссом среди СУБД будет PostgreSQL по ряду причин:
   1) Реляционная структура для финансов, CRM, нормативов
   2) JSONB/TSVECTOR для гибких структур и полнотекстового поиска (лендинги, обучающие материалы)
   3) Расширения и дополнения для узких и специфических задач ()
   4) Поддержка внешних языков (PL/Python, PL/pgSQL, PL/Rust) — для специализированных вычислений

Однако, для очень сложных графовых задач (например поиск маршрутов с множеством условий) — лучше специализированная графовая СУБД. Для сверхнагруженных лендингов — можно использовать внешние NoSQL-хранилища с последующей агрегацией в основной СУБД.

 ---

### Задание 2 Транзакции

2.1. Пользователь пополняет баланс счёта телефона, распишите пошагово, какие действия должны произойти для того, чтобы транзакция завершилась успешно. Ориентируйтесь на шесть действий.

2.1.* Какие действия должны произойти, если пополнение счёта телефона происходило бы через автоплатёж?

Приведите ответ в свободной форме.



### Решение 2 Транзакции

2.1

1) Пользователь инициирует запрос. Пользователь через приложение, терминал или сайт указывает номер телефона и сумму пополнения, выбирает способ оплаты.
2) Проверка корректности данных. Система проверяет валидность введённых данных: правильность номера телефона, допустимость суммы, корректность данных карты. 
3) Блокировка средств на счёте пользователя. Платёжная система временно резервирует (блокирует) деньги на счёте пользователя, чтобы убедиться в их наличии и изоляции для других процессов.
4) Формирование и отправка транзакции. Система по защищённому каналу передаёт оператору мобильной связи запрос на пополнение с указанием номера телефона и суммы.
5) Подтверждение и завершение транзакции. Оператор мобильной связи зачисляет сумму на баланс телефона и отправляет подтверждение об успешной операции в платёжную систему.
6) Фиксация и завершение операции. Платёжная система снимает заблокированную сумму с карты пользователя, завершает транзакцию в своей базе (commit), информирует пользователя об успешном пополнении (смс, push-уведомление).

 ---


### Задание 3 SQL vs NoSQL

3.1. Напишите пять преимуществ SQL-систем по отношению к NoSQL.

3.1.* Какие, на ваш взгляд, преимущества у NewSQL систем перед SQL и NoSQL.

Приведите ответ в свободной форме.

### Решение 3 SQL vs NoSQL

3.1
1) Строгая согласованность данных (ACID):
SQL-системы гарантируют атомарность, согласованность, изолированность и устойчивость транзакций. Это важно для приложений, где недопустимы ошибки в данных (банковские системы, бухгалтерия).
2) Стандартизированный язык запросов (SQL):
SQL — универсальный язык, поддерживаемый большинством реляционных СУБД. Это облегчает обучение, переносимость запросов и интеграцию с различными инструментами.
3) Сложные запросы и аналитика:
SQL-системы поддерживают сложные JOIN, агрегации, вложенные запросы, оконные функции и другие средства анализа данных, что часто недоступно или неудобно реализовано в NoSQL.
4) Целостность данных и ограничения:
В SQL можно задавать внешние ключи, уникальные ограничения, проверки и другие механизмы, которые предотвращают появление некорректных или противоречивых данных.
5) Зрелость и поддержка:
Реляционные СУБД существуют десятилетиями, хорошо документированы, имеют развитое сообщество, множество инструментов для резервного копирования, мониторинга, репликации и восстановления.


3.1.*
- NewSQL сочетает лучшие черты SQL (надёжность, стандартизация и привычный SQL, ACID) и NoSQL (масштабируемость, высокая производительность, гибкость для современных высоконагруженных и распределенных систем), что делает их привлекательными для современных задач, где требуются и большие объёмы данных, и строгие требования к их целостности.

 ---

 ### Задание 4 Кластеры

Необходимо производить большое количество вычислений при работе с огромным количеством данных, под эту задачу выделено 1000 машин.

4.1 На основе какого критерия будете выбирать тип СУБД и какая модель распределённых вычислений здесь справится лучше всего и почему?

Приведите ответ в свободной форме.

### Решение 4 Кластеры

4.1
- Возможна совместное использование модели Apache Spark (поддерживает in-memory вычисления, удобен для сложных аналитических задач, хорошо масштабируется) для сложных распределенных вычислений и ClickHouse (распределённая колоночная СУБД, оптимизированная для быстрых аналитических запросов по большим объёмам данных) для дальнейшей работы и аналитики данных.
NoSQL СУБД (ClickHouse) + MapReduce (Apache Hadoop или лучше Apache Spark).

 ---